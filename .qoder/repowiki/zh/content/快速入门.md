# 快速入门

<cite>
**本文档中引用的文件**  
- [pom.xml](file://pom.xml)
- [SsDriver.java](file://src/main/java/io/leavesfly/smallsql/SsDriver.java)
- [SsConnection.java](file://src/main/java/io/leavesfly/smallsql/jdbc/SsConnection.java)
- [SsResultSet.java](file://src/main/java/io/leavesfly/smallsql/jdbc/SsResultSet.java)
- [CommandCreateDatabase.java](file://src/main/java/io/leavesfly/smallsql/rdb/command/ddl/CommandCreateDatabase.java)
- [CommandInsert.java](file://src/main/java/io/leavesfly/smallsql/rdb/command/dml/CommandInsert.java)
- [CommandSelect.java](file://src/main/java/io/leavesfly/smallsql/rdb/command/dql/CommandSelect.java)
- [Database.java](file://src/main/java/io/leavesfly/smallsql/rdb/engine/Database.java)
- [Table.java](file://src/main/java/io/leavesfly/smallsql/rdb/engine/Table.java)
- [TransactionStep.java](file://src/main/java/io/leavesfly/smallsql/rdb/engine/TransactionStep.java)
</cite>

## 目录
1. [简介](#简介)
2. [Maven依赖配置](#maven依赖配置)
3. [JDBC驱动加载](#jdbc驱动加载)
4. [数据库连接URL格式](#数据库连接url格式)
5. [连接参数与数据库路径配置](#连接参数与数据库路径配置)
6. [完整代码示例](#完整代码示例)
7. [常见问题与解决方案](#常见问题与解决方案)
8. [总结](#总结)

## 简介

SmallSQL 是一个轻量级的纯Java数据库管理系统，支持JDBC接口，适用于嵌入式应用和快速原型开发。本指南将详细介绍如何在Java项目中集成和使用SmallSQL，涵盖从Maven依赖配置到完整数据库操作的全过程。通过本指南，开发者可以快速掌握SmallSQL的核心功能，包括连接管理、SQL执行、事务处理和资源清理。

**Section sources**
- [SsDriver.java](file://src/main/java/io/leavesfly/smallsql/SsDriver.java#L1-L203)
- [SsConnection.java](file://src/main/java/io/leavesfly/smallsql/jdbc/SsConnection.java#L1-L716)

## Maven依赖配置

要在Java项目中使用SmallSQL，首先需要在`pom.xml`文件中添加相应的Maven依赖。SmallSQL作为一个独立的JAR包，可以通过Maven进行管理。以下是在`pom.xml`中配置SmallSQL依赖的示例：

```xml
<dependencies>
    <dependency>
        <groupId>org.yf</groupId>
        <artifactId>smallsql</artifactId>
        <version>1.0.0-SNAPSHOT</version>
    </dependency>
</dependencies>
```

此配置将SmallSQL库添加到项目的依赖中，确保在编译和运行时能够访问SmallSQL的所有类和方法。SmallSQL的依赖不包含任何外部库，因此不会引入额外的依赖冲突。

**Section sources**
- [pom.xml](file://pom.xml#L30-L41)

## JDBC驱动加载

SmallSQL实现了标准的JDBC接口，因此可以使用标准的JDBC方式加载驱动程序。SmallSQL的驱动类为`io.leavesfly.smallsql.SsDriver`，该类在静态初始化块中自动向`DriverManager`注册自身，因此开发者通常不需要显式调用`Class.forName()`来加载驱动。

然而，为了确保驱动被正确加载，特别是在某些类加载器环境下，建议显式加载驱动：

```java
Class.forName("io.leavesfly.smallsql.SsDriver");
```

这行代码会触发`SsDriver`类的静态初始化，从而将驱动注册到JDBC驱动管理器中。一旦驱动被注册，就可以使用`DriverManager.getConnection()`方法建立数据库连接。

**Section sources**
- [SsDriver.java](file://src/main/java/io/leavesfly/smallsql/SsDriver.java#L70-L78)

## 数据库连接URL格式

SmallSQL使用标准的JDBC URL格式来建立数据库连接。连接URL的基本格式如下：

```
jdbc:smallsql:[database_path][?property1=value1[&property2=value2]...]
```

其中：
- `jdbc:smallsql` 是SmallSQL的协议前缀，用于标识这是一个SmallSQL数据库连接。
- `database_path` 是数据库文件的路径，可以是相对路径或绝对路径。如果省略此部分，将创建一个内存数据库。
- 可选的查询参数用于指定连接属性，如自动提交模式、只读模式等。

例如，以下URL连接到当前目录下的`mydb`数据库，并启用自动提交模式：

```
jdbc:smallsql:./mydb?autocommit=true
```

**Section sources**
- [SsDriver.java](file://src/main/java/io/leavesfly/smallsql/SsDriver.java#L45-L50)

## 连接参数与数据库路径配置

SmallSQL支持多种连接参数来配置数据库连接行为。这些参数通过URL中的查询字符串传递，格式为`key=value`。以下是常用的连接参数：

- `dbpath`: 指定数据库文件的路径。如果未在URL中指定路径，此参数可用于明确设置数据库位置。
- `autocommit`: 设置自动提交模式。值为`true`或`false`，默认为`true`。
- `readonly`: 以只读模式打开数据库。值为`true`或`false`，默认为`false`。
- `create`: 如果数据库不存在，是否自动创建。值为`true`或`false`，默认为`true`。

数据库路径可以是相对路径或绝对路径。相对路径相对于当前工作目录，而绝对路径则从文件系统的根目录开始。如果路径指向一个不存在的目录，SmallSQL会尝试创建该目录。

**Section sources**
- [SsDriver.java](file://src/main/java/io/leavesfly/smallsql/SsDriver.java#L100-L150)
- [SsConnection.java](file://src/main/java/io/leavesfly/smallsql/jdbc/SsConnection.java#L80-L90)

## 完整代码示例

以下是一个完整的Java代码示例，演示了如何使用SmallSQL进行数据库操作的完整生命周期，包括连接建立、DDL操作、DML操作、事务处理和资源清理。

```java
import java.sql.*;

public class SmallSQLExample {
    public static void main(String[] args) {
        Connection conn = null;
        Statement stmt = null;
        ResultSet rs = null;
        
        try {
            // 1. 加载驱动（可选，因为SsDriver会自动注册）
            Class.forName("io.leavesfly.smallsql.SsDriver");
            
            // 2. 建立连接
            String url = "jdbc:smallsql:./testdb";
            conn = DriverManager.getConnection(url);
            
            // 3. 设置事务模式
            conn.setAutoCommit(false);
            
            // 4. 创建Statement对象
            stmt = conn.createStatement();
            
            // 5. DDL操作：创建表
            String createTableSQL = "CREATE TABLE users (id INT PRIMARY KEY, name VARCHAR(50), email VARCHAR(100))";
            stmt.executeUpdate(createTableSQL);
            
            // 6. DML操作：插入数据
            String insertSQL = "INSERT INTO users (id, name, email) VALUES (1, '张三', 'zhangsan@example.com')";
            stmt.executeUpdate(insertSQL);
            
            // 7. DML操作：查询数据
            String selectSQL = "SELECT * FROM users";
            rs = stmt.executeQuery(selectSQL);
            
            while (rs.next()) {
                System.out.println("ID: " + rs.getInt("id"));
                System.out.println("Name: " + rs.getString("name"));
                System.out.println("Email: " + rs.getString("email"));
            }
            
            // 8. 提交事务
            conn.commit();
            
        } catch (Exception e) {
            // 9. 发生异常时回滚事务
            if (conn != null) {
                try {
                    conn.rollback();
                } catch (SQLException ex) {
                    ex.printStackTrace();
                }
            }
            e.printStackTrace();
        } finally {
            // 10. 资源清理
            try {
                if (rs != null) rs.close();
                if (stmt != null) stmt.close();
                if (conn != null) conn.close();
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }
}
```

此示例代码展示了SmallSQL使用的完整流程：
1. **驱动加载**：显式加载SmallSQL驱动。
2. **连接建立**：使用JDBC URL建立数据库连接。
3. **事务设置**：禁用自动提交以手动管理事务。
4. **Statement创建**：创建用于执行SQL语句的Statement对象。
5. **DDL操作**：执行CREATE TABLE语句创建新表。
6. **DML操作**：执行INSERT语句插入数据。
7. **查询操作**：执行SELECT语句并遍历结果集。
8. **事务提交**：手动提交事务以保存更改。
9. **异常处理**：在发生异常时回滚事务。
10. **资源清理**：关闭ResultSet、Statement和Connection对象。

**Section sources**
- [SsConnection.java](file://src/main/java/io/leavesfly/smallsql/jdbc/SsConnection.java#L200-L300)
- [SsStatement.java](file://src/main/java/io/leavesfly/smallsql/jdbc/statement/SsStatement.java#L1-L50)
- [SsResultSet.java](file://src/main/java/io/leavesfly/smallsql/jdbc/SsResultSet.java#L1-L100)
- [CommandCreateDatabase.java](file://src/main/java/io/leavesfly/smallsql/rdb/command/ddl/CommandCreateDatabase.java#L1-L68)
- [CommandInsert.java](file://src/main/java/io/leavesfly/smallsql/rdb/command/dml/CommandInsert.java#L1-L208)
- [CommandSelect.java](file://src/main/java/io/leavesfly/smallsql/rdb/command/dql/CommandSelect.java#L1-L588)

## 常见问题与解决方案

在使用SmallSQL时，开发者可能会遇到一些常见问题。以下是这些问题及其解决方案：

### 驱动未找到

**问题描述**：运行时抛出`ClassNotFoundException`，提示无法找到`io.leavesfly.smallsql.SsDriver`类。

**解决方案**：
1. 确保`pom.xml`中正确添加了SmallSQL依赖。
2. 检查Maven依赖是否已正确下载到本地仓库。
3. 确保类路径中包含SmallSQL的JAR文件。
4. 如果使用IDE，尝试刷新Maven项目或重新构建项目。

### 文件权限错误

**问题描述**：连接数据库时抛出`SQLException`，提示无法创建或访问数据库文件。

**解决方案**：
1. 检查数据库路径是否指向一个有效的目录。
2. 确保应用程序对指定目录具有读写权限。
3. 如果路径包含特殊字符，尝试使用绝对路径。
4. 在Windows系统上，避免使用保留的设备名称作为数据库名。

### 数据库已存在

**问题描述**：尝试创建数据库时抛出异常，提示数据库已存在。

**解决方案**：
1. 在连接URL中添加`create=false`参数，以防止自动创建数据库。
2. 在创建数据库前，先检查目标路径是否已存在同名文件。
3. 使用不同的数据库名称或路径。

### 事务处理问题

**问题描述**：事务未按预期提交或回滚。

**解决方案**：
1. 确保在执行DML操作前调用`setAutoCommit(false)`。
2. 在所有操作成功后调用`commit()`方法。
3. 在发生异常时调用`rollback()`方法。
4. 确保在finally块中正确关闭连接，这会自动回滚未提交的事务。

**Section sources**
- [SsDriver.java](file://src/main/java/io/leavesfly/smallsql/SsDriver.java#L100-L150)
- [Database.java](file://src/main/java/io/leavesfly/smallsql/rdb/engine/Database.java#L100-L200)
- [SsConnection.java](file://src/main/java/io/leavesfly/smallsql/jdbc/SsConnection.java#L300-L400)

## 总结

本指南详细介绍了如何在Java项目中集成和使用SmallSQL数据库。通过Maven依赖配置，开发者可以轻松地将SmallSQL添加到项目中。JDBC驱动的自动注册机制简化了驱动加载过程，而标准的JDBC URL格式使得连接配置直观易懂。

SmallSQL支持完整的数据库操作生命周期，包括连接管理、DDL/DML操作、事务处理和资源清理。通过示例代码，我们展示了如何创建表、插入数据、查询结果以及正确管理事务。对于初学者可能遇到的常见问题，如驱动未找到和文件权限错误，我们也提供了相应的解决方案。

SmallSQL作为一个轻量级的嵌入式数据库，非常适合用于开发原型、测试环境或资源受限的应用场景。其纯Java实现和JDBC兼容性使得它易于集成到现有的Java应用程序中，为开发者提供了一个简单而强大的数据存储解决方案。

**Section sources**
- [SsDriver.java](file://src/main/java/io/leavesfly/smallsql/SsDriver.java#L1-L203)
- [SsConnection.java](file://src/main/java/io/leavesfly/smallsql/jdbc/SsConnection.java#L1-L716)
- [SsResultSet.java](file://src/main/java/io/leavesfly/smallsql/jdbc/SsResultSet.java#L1-L800)