# 贡献指南

<cite>
**本文档引用的文件**   
- [README.md](file://README.md)
- [pom.xml](file://pom.xml)
- [Language.java](file://src/main/java/io/leavesfly/smallsql/lang/Language.java)
- [SQLTokenizer.java](file://src/main/java/io/leavesfly/smallsql/rdb/sql/parser/SQLTokenizer.java)
- [SsDriver.java](file://src/main/java/io/leavesfly/smallsql/SsDriver.java)
- [SsConnection.java](file://src/main/java/io/leavesfly/smallsql/jdbc/SsConnection.java)
- [Command.java](file://src/main/java/io/leavesfly/smallsql/rdb/command/Command.java)
- [Database.java](file://src/main/java/io/leavesfly/smallsql/rdb/engine/Database.java)
- [Table.java](file://src/main/java/io/leavesfly/smallsql/rdb/engine/Table.java)
- [SQLParser.java](file://src/main/java/io/leavesfly/smallsql/rdb/sql/SQLParser.java)
- [BasicTestCase.java](file://src/test/java/io/leavesfly/smallsql/junit/BasicTestCase.java)
</cite>

## 目录
1. [项目许可证](#项目许可证)
2. [代码贡献流程](#代码贡献流程)
3. [代码风格规范](#代码风格规范)
4. [问题报告与功能请求](#问题报告与功能请求)
5. [代码审查流程](#代码审查流程)
6. [开发环境设置](#开发环境设置)

## 项目许可证

本项目采用GNU宽通用公共许可证（LGPL）v2.1版本。该许可证允许您在商业和非商业项目中自由使用、修改和分发本软件，同时保护了原作者的版权和贡献者的权益。

### LGPL v2.1对贡献者的意义

1. **自由使用**: 您可以在任何项目中使用SmallSQL，包括闭源商业应用
2. **修改自由**: 您可以自由修改代码以满足特定需求
3. **分发要求**: 当您分发修改后的版本时，必须公开您对SmallSQL本身的修改
4. **链接例外**: 其他软件可以通过动态链接方式使用SmallSQL，而不需要将整个软件开源
5. **专利保护**: 贡献者自动授予用户必要的专利许可

作为贡献者，您保留对自己贡献代码的版权，但通过提交贡献，您同意在LGPL v2.1许可证下授权您的代码。这意味着您的贡献将成为项目的一部分，并受相同许可证的保护和约束。

**Section sources**
- [README.md](file://README.md#L1-L269)

## 代码贡献流程

我们欢迎社区成员通过以下流程为项目做出贡献。请遵循这些步骤确保您的贡献能够顺利被接受。

### 1. Fork仓库

首先，在GitHub上Fork本项目仓库到您的个人账户：
1. 访问项目主页
2. 点击右上角的"Fork"按钮
3. 选择您的账户作为Fork目标

### 2. 创建特性分支

在本地克隆您的Fork，并创建一个新的特性分支：

```bash
# 克隆您的Fork
git clone https://github.com/your-username/smallsql.git
cd smallsql

# 创建特性分支
git checkout -b feature/your-feature-name
```

分支命名应遵循以下约定：
- `feature/`：新功能开发
- `bugfix/`：缺陷修复
- `docs/`：文档更新
- `refactor/`：代码重构

### 3. 开发与测试

在您的特性分支上进行开发，确保：
1. 遵循项目的代码风格规范
2. 添加适当的单元测试
3. 确保现有测试全部通过

```bash
# 运行测试
mvn test
```

### 4. 提交代码

当开发完成并通过测试后，提交您的更改：

```bash
# 添加更改的文件
git add .

# 提交更改
git commit -m "描述您的更改"
```

提交信息应遵循以下格式：
```
[类型] 简短描述

详细描述（可选）
- 说明更改的原因
- 列出重要的实现细节
- 引用相关的问题编号
```

### 5. 发起Pull Request

1. 将您的分支推送到您的Fork：
```bash
git push origin feature/your-feature-name
```

2. 访问您的Fork页面，点击"Compare & pull request"
3. 填写Pull Request模板，包括：
   - 更改的目的和背景
   - 影响的组件
   - 测试方法
   - 相关的问题编号

4. 提交Pull Request，等待代码审查

**Section sources**
- [README.md](file://README.md#L1-L269)
- [pom.xml](file://pom.xml#L0-L41)

## 代码风格规范

为了保持代码库的一致性和可读性，我们遵循Java标准编码规范，并结合项目现有代码的风格。

### 命名约定

- **类名**: 驼峰命名法，首字母大写（`PascalCase`）
  ```java
  public class SsConnection { ... }
  ```

- **方法名**: 驼峰命名法，首字母小写（`camelCase`）
  ```java
  public void executeQuery() { ... }
  ```

- **变量名**: 驼峰命名法，首字母小写（`camelCase`）
  ```java
  private String databasePath;
  ```

- **常量名**: 全大写，下划线分隔（`SNAKE_CASE`）
  ```java
  public static final String DB_READONLY = "SS-0034";
  ```

### 代码格式

- **缩进**: 使用4个空格，不使用Tab
- **行长度**: 建议不超过120个字符
- **花括号**: 开花括号放在行尾，闭花括号单独一行
  ```java
  public void methodName() {
      if (condition) {
          // 代码逻辑
      }
  }
  ```

- **空行**: 
  - 方法之间用一个空行分隔
  - 逻辑块之间用空行分隔
  - 类的成员变量与方法之间用空行分隔

### 注释规范

- **类注释**: 每个类都应有Javadoc注释，描述类的职责和主要功能
  ```java
  /**
   * JDBC连接实现类。
   * 管理数据库连接、事务控制和语句执行。
   */
  public class SsConnection { ... }
  ```

- **方法注释**: 公共方法和重要私有方法应有Javadoc注释
  ```java
  /**
   * 执行SQL查询并返回结果集。
   * 
   * @param sql SQL查询语句
   * @return 查询结果集
   * @throws SQLException SQL执行异常
   */
  public ResultSet executeQuery(String sql) throws SQLException { ... }
  ```

- **行内注释**: 在复杂逻辑处添加解释性注释
  ```java
  // 计算页偏移量，考虑页头大小
  long pageOffset = pageNumber * PAGE_SIZE + HEADER_SIZE;
  ```

### 导入管理

- 按照以下顺序组织import语句：
  1. Java标准库
  2. 第三方库
  3. 本项目包

- 避免使用通配符导入（`import java.util.*`）

**Section sources**
- [SsDriver.java](file://src/main/java/io/leavesfly/smallsql/SsDriver.java)
- [SsConnection.java](file://src/main/java/io/leavesfly/smallsql/jdbc/SsConnection.java)
- [Language.java](file://src/main/java/io/leavesfly/smallsql/lang/Language.java)

## 问题报告与功能请求

我们鼓励社区成员报告问题和提出功能请求。请按照以下指南提供完整的信息。

### 报告问题（Bug Report）

当您发现软件缺陷时，请创建一个详细的问题报告，包含以下信息：

1. **环境信息**:
   - 操作系统
   - Java版本
   - SmallSQL版本

2. **问题描述**:
   - 清晰描述问题现象
   - 说明预期行为和实际行为

3. **重现步骤**:
   - 详细列出重现问题的步骤
   - 提供最小化的代码示例

4. **错误信息**:
   - 完整的异常堆栈跟踪
   - 相关的日志输出

5. **附加信息**:
   - 截图或录屏
   - 相关的数据库文件（如适用）

示例问题报告模板：
```
## 环境
- OS: Windows 10
- Java: 1.8.0_292
- SmallSQL: 1.0.0-SNAPSHOT

## 问题描述
当执行包含子查询的复杂SELECT语句时，程序抛出NullPointerException。

## 重现步骤
1. 创建测试表：CREATE TABLE users (id INT, name VARCHAR(50))
2. 插入测试数据：INSERT INTO users VALUES (1, 'John')
3. 执行查询：SELECT * FROM users WHERE id IN (SELECT id FROM users)

## 错误信息
java.lang.NullPointerException
    at io.leavesfly.smallsql.rdb.sql.parser.SQLParser.parseSubquery(SQLParser.java:123)
    ...
```

### 提出功能请求（Feature Request）

当您希望添加新功能时，请提供以下信息：

1. **功能描述**:
   - 清晰描述您希望添加的功能
   - 说明该功能的用途和价值

2. **使用场景**:
   - 描述功能的典型使用场景
   - 提供实际应用示例

3. **API设计建议**:
   - 建议的API接口设计
   - 方法签名和参数说明

4. **兼容性考虑**:
   - 对现有功能的影响
   - 向后兼容性分析

5. **优先级评估**:
   - 功能的重要性和紧急程度
   - 预期的用户群体

**Section sources**
- [README.md](file://README.md#L1-L269)
- [BasicTestCase.java](file://src/test/java/io/leavesfly/smallsql/junit/BasicTestCase.java#L81-L112)

## 代码审查流程

我们采用严格的代码审查流程来保证代码质量和项目稳定性。

### 审查标准

1. **功能正确性**:
   - 代码是否实现了预期功能
   - 是否覆盖了所有边界情况

2. **代码质量**:
   - 是否遵循代码风格规范
   - 代码是否清晰易读
   - 是否有重复代码

3. **测试覆盖**:
   - 是否包含适当的单元测试
   - 测试是否覆盖了主要使用场景
   - 边界条件是否被测试

4. **性能影响**:
   - 是否有潜在的性能问题
   - 时间和空间复杂度是否合理

5. **安全性**:
   - 是否有安全漏洞
   - 输入验证是否充分

### 审查流程

1. **自动检查**:
   - 代码格式检查
   - 静态代码分析
   - 单元测试执行

2. **人工审查**:
   - 至少两名核心成员审查代码
   - 关注架构设计和实现细节
   - 提出改进建议

3. **讨论与修改**:
   - 贡献者根据反馈修改代码
   - 可能需要多轮审查

4. **最终批准**:
   - 所有审查者同意合并
   - 核心维护者执行合并

### 响应时间期望

- **初步响应**: 我们承诺在3个工作日内对新的Pull Request做出初步响应
- **详细审查**: 在1周内完成详细的代码审查
- **问题讨论**: 对于复杂问题，我们会在2周内给出明确的解决方案或决策
- **紧急修复**: 对于严重安全漏洞，我们会在24小时内响应并处理

我们鼓励贡献者积极参与审查讨论，及时回应审查意见。如果在预期时间内未收到回复，请在Pull Request中礼貌地提醒审查者。

**Section sources**
- [README.md](file://README.md#L1-L269)
- [pom.xml](file://pom.xml#L0-L41)

## 开发环境设置

为了帮助新贡献者快速上手，以下是开发环境的设置指南。

### 系统要求

- **操作系统**: Windows、Linux或macOS
- **Java版本**: JDK 1.8或更高版本
- **构建工具**: Maven 3.x
- **IDE**: 推荐使用IntelliJ IDEA或Eclipse

### 环境配置步骤

1. **安装Java开发环境**:
   ```bash
   # 检查Java版本
   java -version
   javac -version
   ```

2. **安装Maven**:
   ```bash
   # 检查Maven版本
   mvn -version
   ```

3. **克隆代码库**:
   ```bash
   git clone https://github.com/your-username/smallsql.git
   cd smallsql
   ```

4. **导入项目到IDE**:
   - 对于IntelliJ IDEA: File → Open → 选择项目根目录
   - 对于Eclipse: File → Import → Maven → Existing Maven Projects

### 构建与测试

1. **编译项目**:
   ```bash
   mvn clean compile
   ```

2. **运行测试**:
   ```bash
   mvn test
   ```

3. **打包项目**:
   ```bash
   mvn package
   ```

### 项目结构概览

```
src/main/java/io/leavesfly/smallsql/
├── SsDriver.java              # JDBC驱动入口
├── jdbc/                      # JDBC接口实现
│   ├── SsConnection.java
│   ├── SsStatement.java
│   ├── SsResultSet.java
│   └── metadata/             # 元数据支持
├── rdb/                      # 关系数据库核心
│   ├── command/              # SQL命令处理
│   │   ├── ddl/             # 数据定义语言
│   │   ├── dml/             # 数据操作语言
│   │   └── dql/             # 数据查询语言
│   ├── engine/              # 存储引擎
│   │   ├── Database.java
│   │   ├── Table.java
│   │   ├── Index.java
│   │   └── store/           # 存储管理
│   └── sql/                 # SQL解析和处理
├── lang/                    # 国际化支持
├── logger/                  # 日志系统
└── util/                    # 工具类
```

### 调试配置

1. **设置断点**: 在关键方法上设置断点，如`SQLParser.parse()`或`Command.execute()`
2. **运行测试**: 使用调试模式运行相关测试用例
3. **查看变量**: 在调试过程中查看关键数据结构的状态

### 贡献验证

在提交Pull Request之前，请确保：
1. 所有测试用例都通过
2. 代码格式符合规范
3. 添加了适当的单元测试
4. 更新了相关文档

通过遵循这些指南，您将能够快速设置开发环境并开始为项目做出贡献。

**Section sources**
- [pom.xml](file://pom.xml#L0-L41)
- [README.md](file://README.md#L1-L269)
- [SsDriver.java](file://src/main/java/io/leavesfly/smallsql/SsDriver.java)